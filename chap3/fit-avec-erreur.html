
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Ajustement avec des données avec erreurs &#8212; Physique Expérimentale 2</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Aide avec python" href="../appendix/outils-python.html" />
    <link rel="prev" title="Ajustement avec des données sans erreurs" href="fit-sans-erreur.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Physique Expérimentale 2</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../orga/orga.html">
   Informations générales
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../orga/objectif.html">
     Objectifs pédagogiques
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../orga/TP.html">
     Organisation des Travaux pratiques
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../orga/notation.html">
     Évaluations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chap1/chap1.html">
   Concepts de statistiques en physique expérimentale
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chap1/stats.html">
     La place des statistiques en physique expérimentale
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chap1/population.html">
     Population, probabilité et échantillon
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chap1/ensemble.html">
     Définition ensembliste et propriétés des probabilités
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chap1/caracterisation_representation.html">
     Représentation et caractérisation des échantillons de données
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../chap2/chap2.html">
   Lois de probabilités et mesures expérimentales
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../chap2/proba.html">
     Probabilité
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chap2/loi-proba.html">
     Loi de probabilité usuelles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../chap2/erreur.html">
     Notion d’erreur sur une mesure
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="chap3.html">
   Ajustement de modèles sur des données
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="principe.html">
     Principe de l’ajustement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fit-sans-erreur.html">
     Ajustement avec des données sans erreurs
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Ajustement avec des données avec erreurs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../appendix/outils-python.html">
   Aide avec python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/python-base.html">
     Les bases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/variables.html">
     Types de variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/conditions.html">
     Conditionalité, répétition et fonctions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/modules.html">
     Importation et utilisation de modules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/io.html">
     Lecture et écriture de fichiers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/modules_utiles.html">
     Modules utiles
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/guiguem/physexp2/main?urlpath=tree/docs/chap3/fit-avec-erreur.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/chap3/fit-avec-erreur.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Ajustement avec des données avec erreurs
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vraisemblance-et-moindre-carres">
   Vraisemblance et moindre carrés
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extraction-des-meilleurs-parametres">
     Extraction des meilleurs paramètres
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cas-dun-ajustement-lineaire">
     Cas d’un ajustement linéaire
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extraction-de-lerreur-sur-un-parametre">
     Extraction de l’erreur sur un paramètre
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ajustement-dun-histogramme">
     Ajustement d’un histogramme
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Ajustement avec des données avec erreurs</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Ajustement avec des données avec erreurs
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vraisemblance-et-moindre-carres">
   Vraisemblance et moindre carrés
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extraction-des-meilleurs-parametres">
     Extraction des meilleurs paramètres
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cas-dun-ajustement-lineaire">
     Cas d’un ajustement linéaire
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extraction-de-lerreur-sur-un-parametre">
     Extraction de l’erreur sur un paramètre
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ajustement-dun-histogramme">
     Ajustement d’un histogramme
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="ajustement-avec-des-donnees-avec-erreurs">
<span id="content-fit-with-error"></span><h1>Ajustement avec des données avec erreurs<a class="headerlink" href="#ajustement-avec-des-donnees-avec-erreurs" title="Permalink to this headline">#</a></h1>
<p>La minimisation du coefficient de détermination <span class="math notranslate nohighlight">\(R^2\)</span> défini de façon \textit{ad hoc} permet d’estimer la valeur des paramètres d’un modèle à partir d’un jeu de données.
Nous allons présenter ici d’autres quantités ayant des motivations probabilistes, notamment lorsque l’on peut associer à chaque mesure une erreur.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vraisemblance-et-moindre-carres">
<h1>Vraisemblance et moindre carrés<a class="headerlink" href="#vraisemblance-et-moindre-carres" title="Permalink to this headline">#</a></h1>
<p>Une quantité d’intérêt est la <strong>fonction de vraisemblance</strong> <a class="footnote-reference brackets" href="#likelihood" id="id1">1</a>.
Considérons un jeu de données <span class="math notranslate nohighlight">\(\{x_i\} _{i=1...N}\)</span>.
On définit la fonction de vraisemblance <span class="math notranslate nohighlight">\(\mathcal{L}\)</span> des données sachant un modèle comme étant la probabilité d’obtenir toutes les données <span class="math notranslate nohighlight">\(x_i\)</span>.
Si <span class="math notranslate nohighlight">\(p(x_i;\vec{\theta})\)</span> est la probabilité d’obtenir la mesure <span class="math notranslate nohighlight">\(x_i\)</span> avec le jeu de paramètres <span class="math notranslate nohighlight">\(\vec{\theta}\)</span>, la vraisemblance s’écrira donc:</p>
<div class="math notranslate nohighlight" id="equation-vraisemblance">
<span class="eqno">(70)<a class="headerlink" href="#equation-vraisemblance" title="Permalink to this equation">#</a></span>\[
  \mathcal{L}(\vec{\theta}) = \prod _i p(x_i;\vec{\theta}).
\]</div>
<p>On suppose toujours que les mesures sont indépendantes.
Si les données sont placées dans un histogramme, les <span class="math notranslate nohighlight">\(\{x_i\} _{i=1...N}\)</span> sont le nombre de coups dans chaque bin, <span class="math notranslate nohighlight">\(p\)</span> sera une probabilité suivant la loi de Poisson avec <span class="math notranslate nohighlight">\(\lambda\)</span> la valeur attendue du bin prédite par le modèle et comme <span class="math notranslate nohighlight">\(k\)</span> le nombre d’évènements <span class="math notranslate nohighlight">\(x_i\)</span> dans le bin.
Le nombre de coups attendus <span class="math notranslate nohighlight">\(\lambda\)</span> peut lui même suivre un autre modèle et dépendre d’autres paramètres.</p>
<p>Si les données sont des couples ou points <span class="math notranslate nohighlight">\(\left(x_i, y_i\right)\)</span> avec des erreurs <span class="math notranslate nohighlight">\(\sigma _i\)</span> sur les <span class="math notranslate nohighlight">\(y_i\)</span> et que l’on souhaite tester une relation entre <span class="math notranslate nohighlight">\(X\)</span> et <span class="math notranslate nohighlight">\(Y\)</span> (comme par exemple une dépendance linéaire <span class="math notranslate nohighlight">\(Y=aX+b\)</span>), les points de données sont dispersés <em>normalement</em> (selon une loi gaussienne) autour de la prédiction du modèle et la vraisemblance peut s’écrire comme:</p>
<div class="math notranslate nohighlight" id="equation-likelihood-gaussien">
<span class="eqno">(71)<a class="headerlink" href="#equation-likelihood-gaussien" title="Permalink to this equation">#</a></span>\[
  \mathcal{L}(\vec{\theta}) = \prod _i \frac{1}{\sqrt{2\pi}\sigma _i}\exp \left( -\frac{\left(y_i - f(x_i;\vec{\theta})\right)^2}{2\sigma _i^2} \right),
\]</div>
<p>avec <span class="math notranslate nohighlight">\(\theta\)</span> les paramètres du modèle à tester.
Dans ce cas, le nombre de paramètres <span class="math notranslate nohighlight">\(\vec{\theta}\)</span> dépend de la complexité du modèle; les valeurs de <span class="math notranslate nohighlight">\(\vec{\theta}\)</span> qui maximisent <span class="math notranslate nohighlight">\(\mathcal{L}\)</span> est le meilleur modèle par rapport aux données collectées.</p>
<!-- % Notons que cela ne veut pas dire que c'est les paramètres les plus vraisemblables pour ce modèle puisque $\mathcal{L}$ ne contient pas la vraisemblance de ces paramètres a priori, c'est-à-dire avant l'obtention de ces mesures\footnote{Pour cela, il faudrait donc aussi prendre en compte la probabilité de ces paramètres avant les mesures et les intégrer à la vraisemblance. -->
<!-- % On peut utiliser le théorème de Bayes.}. -->
<p>Ici on vient de calculer les paramètres qui rendent les données obtenues les plus probables pour un modèle donné.</p>
<p>On peut noter ici que puisque les probabilités <span class="math notranslate nohighlight">\(p(x_i;\vec{\theta})\)</span> de l’équation <a class="reference internal" href="#equation-vraisemblance">(70)</a> sont plus petites que 1, la fonction de vraisemblance est plus petite que 1.
Notamment, plus le nombre de points de données augmente, plus la vraisemblance est faible.</p>
<p>Dans le cas où on considère un modèle gaussien comme dans l’équation <a class="reference internal" href="#equation-likelihood-gaussien">(71)</a>, on peut utiliser la fonction <span class="math notranslate nohighlight">\(\ln\)</span> pour simplifier le problème:</p>
<div class="math notranslate nohighlight" id="equation-def-chi2">
<span class="eqno">(72)<a class="headerlink" href="#equation-def-chi2" title="Permalink to this equation">#</a></span>\[ 
  \chi ^2 = -2\ln \mathcal{L}(\vec{\theta}) = cste + \sum _i\frac{\left(y_i - f(x_i;\vec{\theta})\right)^2}{\sigma _i^2}.
\]</div>
<p>Le terme <span class="math notranslate nohighlight">\(cste\)</span> est bien une constante ne dépendant que des erreurs des points de données <span class="math notranslate nohighlight">\(\sigma _i\)</span>.
Le <span class="math notranslate nohighlight">\(\chi^2\)</span>, aussi appelé <strong>moindre carrés</strong>, est la somme des écarts quadratiques entre le modèle et les données, pondérés par le carré inverse des incertitudes.
Maximiser la vraisemblance <a class="reference internal" href="#equation-likelihood-gaussien">(71)</a> revient à minimiser le <span class="math notranslate nohighlight">\(\chi ^2\)</span> <a class="reference internal" href="#equation-def-chi2">(72)</a>.</p>
<p>Notons que cela peut s’étendre aussi aux cas des distributions poissonniennes pour des données binnées puisque la distribution de Poisson tend vers une distribution gaussienne quand le nombre d’évènements attendu est “grand”; en pratique, pour <span class="math notranslate nohighlight">\(\lambda \geq 25\)</span>.</p>
<div class="exercise admonition" id="test-chi2">

<p class="admonition-title"><span class="caption-number">Exercise 9 </span></p>
<section id="exercise-content">
<p>On réalise une trentaine de mesures d’une même grandeur.
On obtient les résultats rangés dans la liste suivante:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">valeurs</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">9.19</span><span class="p">,</span> <span class="mf">11.30</span><span class="p">,</span> <span class="mf">4.21</span><span class="p">,</span> <span class="mf">7.88</span><span class="p">,</span> <span class="mf">7.60</span><span class="p">,</span> <span class="mf">11.87</span><span class="p">,</span> <span class="mf">10.53</span><span class="p">,</span> <span class="mf">12.32</span><span class="p">,</span> <span class="mf">10.64</span><span class="p">,</span> <span class="mf">7.21</span><span class="p">,</span> 
            <span class="mf">7.73</span><span class="p">,</span> <span class="mf">12.02</span><span class="p">,</span> <span class="mf">12.93</span><span class="p">,</span> <span class="mf">10.05</span><span class="p">,</span> <span class="mf">13.15</span><span class="p">,</span> <span class="mf">9.55</span><span class="p">,</span> <span class="mf">10.81</span><span class="p">,</span> <span class="mf">12.51</span><span class="p">,</span> <span class="mf">7.44</span><span class="p">,</span> <span class="mf">11.52</span><span class="p">,</span> 
            <span class="mf">11.55</span><span class="p">,</span> <span class="mf">9.38</span><span class="p">,</span> <span class="mf">6.70</span><span class="p">,</span> <span class="mf">11.00</span><span class="p">,</span> <span class="mf">13.48</span><span class="p">,</span> <span class="mf">8.18</span><span class="p">,</span> <span class="mf">7.43</span><span class="p">,</span> <span class="mf">11.37</span><span class="p">,</span> <span class="mf">13.09</span><span class="p">,</span> <span class="mf">9.21</span> <span class="p">]</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Ranger les valeurs dans un histogramme avec 5 bins. La région globale de l’histogramme est entre 2.8 et 15.15.</p></li>
<li><p>Calculer la vraisemblance des données en prenant comme modèle une loi normale d’écart-type 4 et centrée en 10.
On pourra calculer le logarithme de la vraisemblance par commodité.</p></li>
<li><p>Calculer le logarithme de la vraisemblance des données en prenant comme modèle une loi normale d’écart-type 2.4 et centrée en 10.
Comparer avec la valeur obtenue dans la question précédente.
Quelle modèle vous semble plus correct?</p></li>
<li><p>Tracer le logarithme de la vraisemblance en fonction de l’écart-type de la loi normale: on gardera la moyenne de la loi normale fixé à 10.
Estimer la valeur optimale de l’écart-type de la loi normale.</p></li>
<li><p>Estimer la moyenne et l’écart-type de la population à partir de cet échantillon.
Confirmer votre estimation de la question précédente.</p></li>
</ol>
</section>
</div>
<div class="solution dropdown admonition" id="chap3/fit-avec-erreur-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#test-chi2"> Exercise 9</a></p>
<section id="solution-content">
<ol>
<li><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">valeurs</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">9.19</span><span class="p">,</span> <span class="mf">11.30</span><span class="p">,</span> <span class="mf">4.21</span><span class="p">,</span> <span class="mf">7.88</span><span class="p">,</span> <span class="mf">7.60</span><span class="p">,</span> <span class="mf">11.87</span><span class="p">,</span> <span class="mf">10.53</span><span class="p">,</span> <span class="mf">12.32</span><span class="p">,</span> <span class="mf">10.64</span><span class="p">,</span> <span class="mf">7.21</span><span class="p">,</span> 
        <span class="mf">7.73</span><span class="p">,</span> <span class="mf">12.02</span><span class="p">,</span> <span class="mf">12.93</span><span class="p">,</span> <span class="mf">10.05</span><span class="p">,</span> <span class="mf">13.15</span><span class="p">,</span> <span class="mf">9.55</span><span class="p">,</span> <span class="mf">10.81</span><span class="p">,</span> <span class="mf">12.51</span><span class="p">,</span> <span class="mf">7.44</span><span class="p">,</span> <span class="mf">11.52</span><span class="p">,</span> 
        <span class="mf">11.55</span><span class="p">,</span> <span class="mf">9.38</span><span class="p">,</span> <span class="mf">6.70</span><span class="p">,</span> <span class="mf">11.00</span><span class="p">,</span> <span class="mf">13.48</span><span class="p">,</span> <span class="mf">8.18</span><span class="p">,</span> <span class="mf">7.43</span><span class="p">,</span> <span class="mf">11.37</span><span class="p">,</span> <span class="mf">13.09</span><span class="p">,</span> <span class="mf">9.21</span> <span class="p">]</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> <span class="c1"># creation d&#39;un plot</span>
<span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">valeurs</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">5.27</span><span class="p">,</span> <span class="mf">7.74</span><span class="p">,</span> <span class="mf">10.21</span><span class="p">,</span> <span class="mf">12.68</span><span class="p">,</span> <span class="mf">15.15</span><span class="p">])</span>
</pre></div>
</div>
</li>
<li><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">log</span>
<span class="k">def</span> <span class="nf">normale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">moy</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mf">3.14159</span><span class="p">)</span><span class="o">/</span><span class="n">std</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">moy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">lnL</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">valeur</span> <span class="ow">in</span> <span class="n">valeurs</span><span class="p">:</span>
    <span class="n">lnL</span> <span class="o">=</span> <span class="n">lnL</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">normale</span><span class="p">(</span><span class="n">valeur</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lnL(10,4)=&quot;</span><span class="p">,</span> <span class="n">lnL</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lnL</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">valeur</span> <span class="ow">in</span> <span class="n">valeurs</span><span class="p">:</span>
    <span class="n">lnL</span> <span class="o">=</span> <span class="n">lnL</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">normale</span><span class="p">(</span><span class="n">valeur</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lnL(10,2.4)=&quot;</span><span class="p">,</span> <span class="n">lnL</span><span class="p">)</span>
</pre></div>
</div>
<p>La vraisemblance a augmenté avec cette nouvelle valeur d’écart-type; ce nouveau modèle semble plus correct.</p>
</li>
<li><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">logL</span><span class="p">(</span><span class="n">moy</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
    <span class="n">lnL</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">valeur</span> <span class="ow">in</span> <span class="n">valeurs</span><span class="p">:</span>
        <span class="n">lnL</span> <span class="o">=</span> <span class="n">lnL</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">normale</span><span class="p">(</span><span class="n">valeur</span><span class="p">,</span> <span class="n">moy</span><span class="p">,</span> <span class="n">std</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lnL</span>

<span class="n">v_std</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="o">+</span> <span class="mf">3.</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="mi">20</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span class="n">v_logL</span> <span class="o">=</span> <span class="p">[</span><span class="n">logL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">v_std</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span> <span class="c1"># creation d&#39;un plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v_std</span><span class="p">,</span> <span class="n">v_logL</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Ecart-type loi normale&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Log-vraisemblance&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>La valeur qui semble maximiser la vraisemblance est autour de 2.4.</p>
</li>
<li><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">valeurs</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">6.967</span><span class="p">,</span> <span class="mf">9.582</span><span class="p">,</span> <span class="mf">14.881</span><span class="p">,</span> <span class="mf">8.981</span><span class="p">,</span> <span class="mf">4.385</span><span class="p">,</span> <span class="mf">9.424</span><span class="p">,</span> <span class="mf">14.381</span><span class="p">,</span> <span class="mf">7.896</span><span class="p">,</span> <span class="mf">10.867</span><span class="p">,</span> <span class="mf">9.242</span><span class="p">,</span>
        <span class="mf">8.430</span><span class="p">,</span> <span class="mf">9.194</span><span class="p">,</span> <span class="mf">9.417</span><span class="p">,</span> <span class="mf">9.869</span><span class="p">,</span> <span class="mf">12.418</span><span class="p">,</span> <span class="mf">11.383</span><span class="p">,</span> <span class="mf">10.119</span><span class="p">,</span> <span class="mf">13.318</span><span class="p">,</span> <span class="mf">11.134</span><span class="p">,</span> <span class="mf">8.748</span><span class="p">,</span>
        <span class="mf">12.624</span><span class="p">,</span> <span class="mf">13.815</span><span class="p">,</span> <span class="mf">12.745</span><span class="p">,</span> <span class="mf">7.874</span><span class="p">,</span> <span class="mf">10.923</span><span class="p">,</span> <span class="mf">8.243</span><span class="p">,</span> <span class="mf">8.596</span><span class="p">,</span> <span class="mf">6.824</span><span class="p">,</span> <span class="mf">12.765</span><span class="p">,</span> <span class="mf">10.988</span> <span class="p">]</span>

<span class="n">moyenne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">valeurs</span><span class="p">)</span>
<span class="n">stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">valeurs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moyenne = </span><span class="si">{0:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">moyenne</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ecart-type = </span><span class="si">{0:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stdev</span><span class="p">))</span>
</pre></div>
</div>
<p>La valeur de l’écart-type trouvée ici est très proche de la valeur estimée dans la question précédente.</p>
</li>
</ol>
</section>
</div>
<div class="cell tag_hide-output tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lnL(10,4)= -74.03191478477355
lnL(10,2.4)= -67.37370718290495
Moyenne = 10.201
Ecart-type = 2.402
</pre></div>
</div>
<img alt="../_images/fit-avec-erreur_1_1.png" src="../_images/fit-avec-erreur_1_1.png" />
<img alt="../_images/fit-avec-erreur_1_2.png" src="../_images/fit-avec-erreur_1_2.png" />
</div>
</div>
<section id="extraction-des-meilleurs-parametres">
<h2>Extraction des meilleurs paramètres<a class="headerlink" href="#extraction-des-meilleurs-parametres" title="Permalink to this headline">#</a></h2>
<p>Trouver les meilleurs paramètres d’un modèle selon les données collectées revient à maximiser la vraisemblance ou bien minimiser le <span class="math notranslate nohighlight">\(\chi ^2\)</span>.
Cela peut se faire numériquement, par exemple, avec le module <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> ou bien analytiquement: en généralisant pour des paramètres <span class="math notranslate nohighlight">\(\vec{\theta}\)</span>, le système d’équations à résoudre est\footnote{Pour que ces paramètres minimisent bien le <span class="math notranslate nohighlight">\(\chi^2\)</span>, il faut aussi vérifier que <span class="math notranslate nohighlight">\(\left.\frac{\partial^2 \chi ^2}{\partial \vec{\theta}^2}\right\vert_{\vec{\theta}=\hat{\vec{\theta}}} &gt; 0\)</span>.}:</p>
<div class="amsmath math notranslate nohighlight" id="equation-0eb70108-4d8e-42c8-826c-952ce45b363e">
<span class="eqno">(73)<a class="headerlink" href="#equation-0eb70108-4d8e-42c8-826c-952ce45b363e" title="Permalink to this equation">#</a></span>\[\begin{equation}
  \left.\frac{\partial \chi ^2}{\partial \vec{\theta}}\right\vert_{\vec{\theta}=\hat{\vec{\theta}}} = 0.
\end{equation}\]</div>
<!-- % Pour certains modèles, il est possible de trouver une expression analytique des meilleurs paramètres utilisant les valeurs des données. -->
<p>En particulier, pour des modèles qui dépendent linéairement de ses paramètres comme par exemple <span class="math notranslate nohighlight">\(f(x) = ax+b\)</span> ou <span class="math notranslate nohighlight">\(f(x) = a\sin x + be^x\)</span>, on peut résoudre le système:</p>
<div class="math notranslate nohighlight">
\[
  \left.\frac{\partial \chi ^2}{\partial a}\right\vert_{a=\hat{a},b=\hat{b}} = \sum _i \frac{\partial f(x_i;\hat{a},\hat{b}) }{\partial a}\left( \frac{y_i - f(x_i;\hat{a},\hat{b})}{\sigma _i ^2} \right) =  0,
\]</div>
<div class="math notranslate nohighlight">
\[
  \left.\frac{\partial \chi ^2}{\partial b}\right\vert_{a=\hat{a},b=\hat{b}} =  \sum _i \frac{\partial f(x_i;\hat{a},\hat{b}) }{\partial b}\left( \frac{y_i - f(x_i;\hat{a},\hat{b})}{\sigma _i ^2} \right) = 0
\]</div>
<p>pour <span class="math notranslate nohighlight">\(\hat{a}\)</span> et <span class="math notranslate nohighlight">\(\hat{b}\)</span> les paramètres optimaux du modèle.</p>
</section>
<section id="cas-dun-ajustement-lineaire">
<h2>Cas d’un ajustement linéaire<a class="headerlink" href="#cas-dun-ajustement-lineaire" title="Permalink to this headline">#</a></h2>
<p>Dans le cas fréquent où <span class="math notranslate nohighlight">\(f(x) = ax+b\)</span>, on peut résoudre le système en posant:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
  A=\sum_i \frac{x_iy_i}{\sigma _i ^2},\,B=\sum_i \frac{x_i^2}{\sigma _i ^2},\\
  C=\sum_i \frac{x_i}{\sigma _i ^2},\,D=\sum_i \frac{y_i}{\sigma _i ^2}\, \mathrm{et} \, E=\sum_i \frac{1}{\sigma _i ^2}.
\end{gather*}\]</div>
<p>La solution est alors:</p>
<div class="math notranslate nohighlight" id="equation-solana-lineaire">
<span class="eqno">(74)<a class="headerlink" href="#equation-solana-lineaire" title="Permalink to this equation">#</a></span>\[
  \hat{a} = \frac{AE-DC}{BE-C^2} \, \mathrm{et} \, \hat{b} = \frac{DB-AC}{BE-C^2}.
\]</div>
<p>Dans le cas où <span class="math notranslate nohighlight">\(f(x) = ax\)</span>, l’expression du meilleur paramètre <span class="math notranslate nohighlight">\(\hat{a}\)</span> se simplifie comme:</p>
<div class="math notranslate nohighlight" id="equation-linearfit-analytical">
<span class="eqno">(75)<a class="headerlink" href="#equation-linearfit-analytical" title="Permalink to this equation">#</a></span>\[
  \hat{a} = \frac{A}{B}.
\]</div>
<div class="admonition-exemple-ajustement-lineaire-simple-suite admonition" id="admon-linearfit-2">
<p class="admonition-title">Exemple: Ajustement linéaire simple – suite</p>
<p>En reprenant les données dans la table <a class="reference internal" href="fit-sans-erreur.html#tab-linear-data"><span class="std std-ref">Jeu de données linéaires</span></a> ainsi que des erreurs associées, on peut calculer les valeurs optimales paramètres de pente et d’intersection à l’origine en utilisant</p>
<ul class="simple">
<li><p>une minimisation de <span class="math notranslate nohighlight">\(\chi ^2\)</span> donné par l’équation <a class="reference internal" href="#equation-def-chi2">(72)</a>,</p></li>
<li><p>les relations analytiques <a class="reference internal" href="#equation-solana-lineaire">(74)</a>.</p></li>
</ul>
<p>On peut voir que les résultats trouvés par les trois méthodes sont proches (ce qui est rassurant).
En revanche, les paramètres sont différents que ceux trouvés par la méthode sans erreur du premier exemple .
Cela est du au fait que les points de données n’ont pas la même erreur, et donc le même poids.</p>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">qexpy</span>
<span class="kn">import</span> <span class="nn">qexpy.plotting</span> <span class="k">as</span> <span class="nn">qplt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">])</span>
<span class="n">err_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span>

<span class="c1"># ajustement par curve_fit</span>
<span class="n">valeurs</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">err_y</span><span class="p">)</span>
<span class="n">a_fit</span> <span class="o">=</span> <span class="n">valeurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b_fit</span> <span class="o">=</span> <span class="n">valeurs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># ajustement par qexpy</span>
<span class="n">xmeas</span> <span class="o">=</span> <span class="n">qexpy</span><span class="o">.</span><span class="n">MeasurementArray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">ymeas</span> <span class="o">=</span> <span class="n">qexpy</span><span class="o">.</span><span class="n">MeasurementArray</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">err_y</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">qplt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmeas</span><span class="p">,</span> <span class="n">ymeas</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;données&#39;</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">qexpy</span><span class="o">.</span><span class="n">FitModel</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">)</span>
<span class="n">a_qexpy</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="c1"># extraction de a</span>
<span class="n">b_qexpy</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="c1"># extraction de b</span>
<span class="n">qplt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># méthode par les relations analytiques</span>
<span class="n">A</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="n">C</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="n">D</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="n">A</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">B</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">C</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">D</span> <span class="o">+=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">E</span> <span class="o">+=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">a_ana</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">E</span><span class="o">-</span><span class="n">D</span><span class="o">*</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">E</span><span class="o">-</span><span class="n">C</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>
<span class="n">b_ana</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">E</span><span class="o">-</span><span class="n">C</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Résultats:</span>
<span class="s1">Curve fit: a = </span><span class="si">{:.2f}</span><span class="s1">; b = </span><span class="si">{:.2f}</span><span class="s1"></span>
<span class="s1">QExPy: a = </span><span class="si">{:.2f}</span><span class="s1">; b = </span><span class="si">{:.2f}</span><span class="s1"></span>
<span class="s1">Analytique: a = </span><span class="si">{:.2f}</span><span class="s1">; b = </span><span class="si">{:.2f}</span><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_fit</span><span class="p">,</span> <span class="n">b_fit</span><span class="p">,</span> <span class="n">a_qexpy</span><span class="p">,</span> <span class="n">b_qexpy</span><span class="p">,</span> <span class="n">a_ana</span><span class="p">,</span> <span class="n">b_ana</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fit-avec-erreur_3_0.png" src="../_images/fit-avec-erreur_3_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Résultats:
Curve fit: a = 0.27; b = 0.97
QExPy: a = 0.27; b = 0.97
Analytique: a = 0.27; b = 0.97
</pre></div>
</div>
</div>
</div>
<p>L’utilisation des librairies externes permet de réaliser des ajustements plus complexes qui ne possèdent pas de solution analytique; il est cependant important de les comparer avec des relations analytiques (“benchmarking”) afin de vérifier que les résultats données correspondent à ce que l’on attend.</p>
</section>
<section id="extraction-de-lerreur-sur-un-parametre">
<h2>Extraction de l’erreur sur un paramètre<a class="headerlink" href="#extraction-de-lerreur-sur-un-parametre" title="Permalink to this headline">#</a></h2>
<p>L’erreur sur un paramètre est défini en terme de probabilité d’obtenir la vraie valeur à partir des données mesurées: il faut intégrer la fonction de vraisemblance sur l’intervalle de confiance définie par la valeur moyenne <span class="math notranslate nohighlight">\(\theta\)</span> et l’erreur <span class="math notranslate nohighlight">\(\sigma_{\theta}\)</span> sur les paramètres <span class="math notranslate nohighlight">\(\left[\theta-\sigma_{\theta},\theta+\sigma_{\theta}\right]\)</span>.
En général, c’est un travail très complexe car la fonction de vraisemblance peut contenir des densité de probabilité complexe à écrire et intégrer; de plus, le nombre de dimensions à intégrer est égal au nombre de paramètres du modèle, rendant le calcul impraticable lorsque le nombre de paramètres est très grand.</p>
<p>Cependant, pour des modèles simples comme des modèles linéaires avec des distributions gaussiennes des données, il est possible de calculer les erreurs sur les paramètres en utilisant le <span class="math notranslate nohighlight">\(\chi ^2\)</span> <a class="reference internal" href="#equation-def-chi2">(72)</a>.
Dans le cas simple d’un ajustement linéaire <span class="math notranslate nohighlight">\(y=ax+b\)</span>, les erreurs sur les paramètres <span class="math notranslate nohighlight">\(a\)</span> et <span class="math notranslate nohighlight">\(b\)</span> sont définis par:</p>
<div class="math notranslate nohighlight" id="equation-err-a">
<span class="eqno">(76)<a class="headerlink" href="#equation-err-a" title="Permalink to this equation">#</a></span>\[
\Delta a \,\mathrm{tel\,que\,}\, \chi^{2}(a+\Delta a, \hat{b})=\chi^{2}(a-\Delta a, \hat{b})=\chi_{\min }^{2}-2 \ln (1-\alpha),
\]</div>
<div class="math notranslate nohighlight">
\[ 
 \Delta b \,\mathrm{tel\,que\,}\, \chi^{2}(\hat{a}, b+\Delta b)=\chi^{2}(\hat{a}, b-\Delta b)=\chi_{\min }^{2}-2 \ln (1-\alpha),
\]</div>
<p>avec <span class="math notranslate nohighlight">\(\alpha\)</span> la probabilité souhaitée.
Ces erreurs valent:</p>
<div class="math notranslate nohighlight" id="equation-error-linearfit-a">
<span class="eqno">(77)<a class="headerlink" href="#equation-error-linearfit-a" title="Permalink to this equation">#</a></span>\[
    \Delta a=\frac{\sqrt{-2 \ln (1-\alpha)}}{\sqrt{B}}=\frac{\sqrt{-2 \ln (1-\alpha)}}{\sqrt{\sum \frac{x_{1}^{2}}{\left(\Delta y_{1}\right)^{2}}}},
\]</div>
<div class="math notranslate nohighlight" id="equation-error-linearfit-b">
<span class="eqno">(78)<a class="headerlink" href="#equation-error-linearfit-b" title="Permalink to this equation">#</a></span>\[ 
    \Delta b=\frac{\sqrt{-2 \ln (1-\alpha)}}{\sqrt{E}}=\frac{\sqrt{-2 \ln (1-\alpha)}}{\sqrt{\sum \frac{1}{\left(\Delta y_{i}\right)^{2}}}}.
\]</div>
<p>Le terme <span class="math notranslate nohighlight">\(\sqrt{-2 \ln (1-\alpha)}\)</span> vaut:</p>
<ul class="simple">
<li><p>pour une erreur définie “à un sigma”, <span class="math notranslate nohighlight">\(\alpha=68.3~\%\)</span>, alors <span class="math notranslate nohighlight">\(\sqrt{-2 \ln (1-\alpha)} = 1.52\)</span>,</p></li>
<li><p>pour une erreur définie “à deux sigmas”, <span class="math notranslate nohighlight">\(\alpha=95.4~\%\)</span>, alors <span class="math notranslate nohighlight">\(\sqrt{-2 \ln (1-\alpha)} = 2.49\)</span>,</p></li>
<li><p>pour une erreur définie “à trois sigmas”, <span class="math notranslate nohighlight">\(\alpha=99.7~\%\)</span>, alors <span class="math notranslate nohighlight">\(\sqrt{-2 \ln (1-\alpha)} = 3.44\)</span>.</p></li>
</ul>
<!-- % Dans de distributions de données gaussiennes, les erreurs sur les paramètres du modèle sont estimées par la dérivée de la fonction de vraisemblance \ref{eq:likelihood-gaussien} (et par conséquent au $\chi ^2$ \ref{eq:def-chi2}):
% \begin{equation}
%     \sigma _{\theta}^2 = \frac{1}{\left(\frac{\partial \ln \mathcal{L}}{\partial \theta}\right)^2}= \frac{-1}{\frac{\partial ^2 \ln \mathcal{L}}{\partial \theta^2}} = \frac{1}{\frac{1}{2}\frac{\partial ^2 \chi ^2}{\partial \theta ^2}} .
% \end{equation}

% \todo[inline]{Ajouter le calcul des erreurs sur les paramètres d'ajustement} -->
<div class="admonition-exemple-ajustement-lineaire-simple-suite-et-fin admonition">
<p class="admonition-title">Exemple: Ajustement linéaire simple – suite et fin</p>
<p>En reprenant les données dans la table <a class="reference internal" href="fit-sans-erreur.html#tab-linear-data"><span class="std std-ref">Jeu de données linéaires</span></a>, on peut calculer les erreurs en utilisant les relations <a class="reference internal" href="#equation-error-linearfit-a">(77)</a> et <a class="reference internal" href="#equation-error-linearfit-b">(78)</a>.</p>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">])</span>
<span class="n">err_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="c1"># relations analytiques</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="n">B</span> <span class="o">+=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">E</span> <span class="o">+=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">err_y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">a_error2</span> <span class="o">=</span> <span class="mf">1.52</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="n">b_error2</span> <span class="o">=</span> <span class="mf">1.52</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Erreur sur a: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_error2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Erreur sur b: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b_error2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Erreur sur a: 0.03
Erreur sur b: 0.15
</pre></div>
</div>
</div>
</div>
<p>L’erreur sur <span class="math notranslate nohighlight">\(a\)</span> correspond à un intervalle à 68.3 % autour de la meilleure valeur de <span class="math notranslate nohighlight">\(a\)</span> (ici, 0.27).
De par sa définition <a class="reference internal" href="#equation-err-a">(76)</a>, cette erreur prend en compte la corrélation avec le coefficient <span class="math notranslate nohighlight">\(b\)</span>.
Certains algorithmes comme QExPy donnent une valeur d’erreur sur les paramètres ajustés qui ne prend pas en compte les corrélations entre les paramètres, mais donnent la valeur de corrélation avec l’erreur.
Il est donc important de toujours comparer le résultat et notamment les erreurs données par un algorithme ou une librairie au résultat donné par la méthode analytique afin de vérifier que les conventions sont identiques.</p>
</section>
<section id="ajustement-dun-histogramme">
<span id="content-chi2-histo"></span><h2>Ajustement d’un histogramme<a class="headerlink" href="#ajustement-dun-histogramme" title="Permalink to this headline">#</a></h2>
<p>Lorsque les données suivant une certaine loi de probabilité <span class="math notranslate nohighlight">\(f(x;\vec{\theta})\)</span> sont rangées dans un histogramme, il est possible d’estimer les paramètres de cette densité de probabilité.
Pour cela on construit la fonction de vraisemblance <a class="reference internal" href="#equation-vraisemblance">(70)</a> en supposant que le contenu de chaque classe <span class="math notranslate nohighlight">\(N_i\)</span> est distribué selon une loi poissonienne autour de la valeur vraie <span class="math notranslate nohighlight">\(f(x_i;\vec{\theta})\times \delta x\)</span> où <span class="math notranslate nohighlight">\(x_i\)</span> représente le centre de la classe et <span class="math notranslate nohighlight">\(\delta x\)</span> la largeur de la classe: on a alors</p>
<div class="amsmath math notranslate nohighlight" id="equation-4638fd3d-5f45-40c9-afa5-319e16e0647e">
<span class="eqno">(79)<a class="headerlink" href="#equation-4638fd3d-5f45-40c9-afa5-319e16e0647e" title="Permalink to this equation">#</a></span>\[\begin{equation}
  \mathcal{L}(\vec{\theta}) = \prod _i \frac{e^{-f(x_i;\vec{\theta}) \delta x}\left(f(x_i;\vec{\theta}) \delta x\right)^{N_i}}{N_i !}.
\end{equation}\]</div>
<p>Dans le cas où le nombre de coups dans chaque classe est grand (<span class="math notranslate nohighlight">\(N_i&gt;25\)</span>), on peut faire l’approximation de la densité de Poisson par une loi normale d’écart type <span class="math notranslate nohighlight">\(\sigma _i = \sqrt{N_i}\)</span>.
La maximisation de la fonction de vraisemblance est alors la minimisation du <span class="math notranslate nohighlight">\(\chi ^2\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-dec2bb17-f450-4946-8313-41dff985df9d">
<span class="eqno">(80)<a class="headerlink" href="#equation-dec2bb17-f450-4946-8313-41dff985df9d" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \chi ^2 = \sum _i\frac{\left(N_i - f(x_i;\vec{\theta})\delta x\right)^2}{N_i}.
\end{equation}\]</div>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="likelihood"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Likelihood en anglais.</p>
</dd>
</dl>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chap3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="fit-sans-erreur.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Ajustement avec des données sans erreurs</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../appendix/outils-python.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Aide avec python</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Mathieu Guigue<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>